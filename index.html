<head>
    <script>
        // https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb
        function componentToHex(c) {
            var hex = Math.floor(c).toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        }

        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        }

        function similarity(a, b) {
            var sum = 0
            var overlap = Math.min(a.length, b.length)
            for (var i = 0; i < overlap; i++) {
                sum += a.charAt(i) == b.charAt(i) ? 1 : 0
            }
            return sum / overlap
        }

        function colour(char, value) {
            console.log(value)
            var color = rgbToHex(255 * (1 - value), 255 * value, 0)
            return `<font color='${color}'>${char}</font>`
        }

        function convolute(a, b) {
            // Very much think of b as fixed in place and a moved along it
            var responseArray = new Array(b.length + 1).join('0').split('').map(parseFloat)

            addToResponse = function (place, amount) {
                for (var j = 0; j < a.length; j++) {
                    responseArray[place + j] += amount
                }
            }
            if (a.length > b.length) {
                return responseArray
            }
            for (var i = 0; i < (b.length - a.length + 1); i++) {
                addToResponse(i, similarity(a, b.substr(i, a.length)))
            }
            return responseArray
        }

        function assessPhrases() {
            var phraseBlock = document.getElementById("phrases").value.toLowerCase()
            var speech = document.getElementById("speech").value
            var speechLower = speech.toLowerCase()
            var phrases = phraseBlock.split('\n')
            document.getElementById("output").innerHTML = ""

            var scores = []

            for (var i = 0; i < phrases.length; i++) {
                var phrase = phrases[i]
                var score = convolute(phrase, speechLower)
                scores.push(score)
            }

            var finalScores = []
            var maxScore = 0

            for (var i = 0; i < speech.length; i++) {
                var finalScore = 0
                for (var j = 0; j < scores.length; j++) {
                    finalScore = Math.max(finalScore, scores[j][i])
                }

                gate = x => x > 0.5 ? x : 0

                var constrainedScore = gate(finalScore)

                finalScores.push(constrainedScore)
                maxScore = Math.max(constrainedScore, maxScore)
            }

            var finalText = ""
            for (var i = 0; i < speech.length; i++) {
                finalText += colour(speech[i], finalScores[i] / maxScore)
            }
            document.getElementById("output").innerHTML = finalText
        }
    </script>
</head>

<body>
    <div>
        <textarea id="phrases">
phrase
</textarea>
    </div>
    <div>
        <textarea id="speech">
Speech that contains phrase
</textarea>
    </div>
    <div>
        <span id="output">

    </span>
    </div>
</body>